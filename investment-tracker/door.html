<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self' 'unsafe-inline'; style-src 'self' 'unsafe-inline' https://fonts.googleapis.com; img-src 'self' data: https:; font-src https://fonts.gstatic.com; connect-src 'self' https://query1.finance.yahoo.com;">
    <title>å€‹äººæŠ•è³‡ç´€éŒ„è¡¨</title>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <!-- Design System -->
    <link rel="stylesheet" href="css/design-system/tokens.css">
    <!-- Components -->
    <link rel="stylesheet" href="css/components/main.css">
    <link rel="stylesheet" href="css/components/app-bar.css">
    <link rel="stylesheet" href="css/components/navigation-tabs.css">
    <link rel="stylesheet" href="css/components/card.css">
    <link rel="stylesheet" href="css/components/forms.css">
    <link rel="stylesheet" href="css/components/buttons.css">
    <link rel="stylesheet" href="css/components/data-table.css">
    <link rel="stylesheet" href="css/components/summary.css">
    <link rel="stylesheet" href="css/components/portfolio-cards.css">
    <!-- Responsive -->
    <link rel="stylesheet" href="css/responsive/responsive.css">
    
    <!-- MD3 ä¸‹æ‹‰é¸å–®å¼·åˆ¶æ¨£å¼ -->
    <style>
        /* å¼·åˆ¶MD3ä¸‹æ‹‰é¸å–®æ¨£å¼ - æœ€é«˜å„ªå…ˆç´š */
        select, .text-field select {
            border-radius: 16px !important;
            border: 2px solid #79747E !important;
            background-color: #F7F2FA !important;
            box-shadow: 0px 1px 2px 0px rgba(0, 0, 0, 0.3), 0px 1px 3px 1px rgba(0, 0, 0, 0.15) !important;
            -webkit-appearance: none !important;
            -moz-appearance: none !important;
            appearance: none !important;
            background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='%23625B71'%3e%3cpath d='M7 10l5 5 5-5z'/%3e%3c/svg%3e") !important;
            background-repeat: no-repeat !important;
            background-position: right 16px center !important;
            background-size: 24px 24px !important;
            padding-right: 56px !important;
        }
        
        select:focus, .text-field select:focus {
            border-color: #6750A4 !important;
            background-color: #FEF7FF !important;
            background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='%236750A4'%3e%3cpath d='M7 10l5 5 5-5z'/%3e%3c/svg%3e") !important;
            box-shadow: 0 0 0 2px #6750A4, 0px 1px 3px 0px rgba(0, 0, 0, 0.3), 0px 4px 8px 3px rgba(0, 0, 0, 0.15) !important;
            transform: translateY(-1px) !important;
        }
        
        select:hover:not(:focus), .text-field select:hover:not(:focus) {
            border-color: #1D1B20 !important;
            background-color: #FEF7FF !important;
            background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='%23484248'%3e%3cpath d='M7 10l5 5 5-5z'/%3e%3c/svg%3e") !important;
            box-shadow: 0px 1px 2px 0px rgba(0, 0, 0, 0.3), 0px 2px 6px 2px rgba(0, 0, 0, 0.15) !important;
            transform: translateY(-0.5px) !important;
        }
    </style>
    
    <script>
        // è‡¨æ™‚å‡½æ•¸å®šç¾©ï¼ˆä¿è­·å¼ï¼‰ï¼šåƒ…åœ¨æ­£å¼å‡½å¼å°šæœªè¨»å†Šæ™‚æ‰æä¾›å‚™æ´ï¼Œé¿å…è¦†è“‹
        window.addStockBuyRecord = window.addStockBuyRecord || function() {
            alert('è‚¡ç¥¨è²·é€²åŠŸèƒ½æ­£åœ¨ä¿®å¾©ä¸­...');
        };
        
        window.addStockSellRecord = window.addStockSellRecord || function() {
            alert('è‚¡ç¥¨è³£å‡ºåŠŸèƒ½æ­£åœ¨ä¿®å¾©ä¸­...');
        };
        
        window.addFundRecord = window.addFundRecord || function() {
            alert('åŸºé‡‘è¨˜éŒ„åŠŸèƒ½æ­£åœ¨ä¿®å¾©ä¸­...');
        };
        
        window.addCryptoRecord = window.addCryptoRecord || function() {
            alert('åŠ å¯†è²¨å¹£åŠŸèƒ½æ­£åœ¨ä¿®å¾©ä¸­...');
        };
        
        window.addPropertyRecord = window.addPropertyRecord || function() {
            alert('æˆ¿åœ°ç”¢åŠŸèƒ½æ­£åœ¨ä¿®å¾©ä¸­...');
        };
        
        window.addPaymentRecord = window.addPaymentRecord || function() {
            alert('ç¹³æ¬¾è¨˜éŒ„åŠŸèƒ½æ­£åœ¨ä¿®å¾©ä¸­...');
        };
        
        window.showTab = window.showTab || function(tabName) {
            // ç§»é™¤æ‰€æœ‰ active é¡åˆ¥
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
            });
            document.querySelectorAll('.navigation-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // è¨­ç½®æ–°çš„ active
            const targetContent = document.getElementById(tabName);
            const targetTab = document.querySelector(`[data-tab="${tabName}"]`);
            
            if (targetContent) targetContent.classList.add('active');
            if (targetTab) targetTab.classList.add('active');
            
            console.log('åˆ‡æ›åˆ°æ¨™ç±¤:', tabName);
        };
        
        window.updateBuyStockForm = window.updateBuyStockForm || function() {
            console.log('æ›´æ–°è²·é€²è¡¨å–®');
        };
        
        window.updateSellStockForm = window.updateSellStockForm || function() {
            console.log('æ›´æ–°è³£å‡ºè¡¨å–®');
        };
        
        console.log('âœ… è‡¨æ™‚å‡½æ•¸å·²è¼‰å…¥ï¼Œé é¢å¯ä»¥åŸºæœ¬é‹ä½œ');
        </script>

    <!-- Electron æ‡‰ç”¨ç¨‹å¼ï¼šè³‡æ–™åº«æœå‹™å·²æ•´åˆåˆ°å¾Œç«¯ -->
    <!-- çµ±ä¸€æ¨¡çµ„è¼‰å…¥ -->
    <script type="module">
        // å„ªå…ˆè¼‰å…¥äº‹ä»¶ç›£è½å™¨ï¼Œç¢ºä¿ onclick å‡½æ•¸å¯ç”¨
        import('./js/core/events.js').then(module => {
            module.initializeEventListeners();
            console.log('âœ… äº‹ä»¶ç›£è½å™¨å·²åˆå§‹åŒ–');
        }).catch(error => {
            console.error('âŒ äº‹ä»¶ç›£è½å™¨è¼‰å…¥å¤±æ•—:', error);
        });
        
        // è¼‰å…¥ä¸»æ‡‰ç”¨é‚è¼¯
        import('./js/main.js').catch(error => {
            console.error('âŒ ä¸»æ‡‰ç”¨è¼‰å…¥å¤±æ•—:', error);
        });
        
        // è¼‰å…¥åŠ å¯†è²¨å¹£åŠŸèƒ½
        import('./js/features/crypto.js').catch(error => {
            console.error('âŒ åŠ å¯†è²¨å¹£åŠŸèƒ½è¼‰å…¥å¤±æ•—:', error);
        });
    </script>
    <script src="js/ui/customSelect.js"></script>
    
    <!-- å…¨å±€è‡ªå®šç¾©å°è©±æ¡† -->
    <script>
        // è®“è‡ªå®šç¾©å°è©±æ¡†å‡½æ•¸å…¨å±€å¯ç”¨
        window.showCustomDialog = function(options) {
            return new Promise((resolve) => {
                const overlay = document.createElement('div');
                overlay.className = 'custom-dialog-overlay';
                
                const dialog = document.createElement('div');
                dialog.className = 'custom-dialog';
                
                const header = document.createElement('div');
                header.className = 'custom-dialog-header';
                
                const icon = document.createElement('span');
                icon.className = 'material-icons custom-dialog-icon';
                icon.textContent = options.icon || 'info';
                
                const title = document.createElement('h3');
                title.className = 'custom-dialog-title';
                title.textContent = options.title || 'ç¢ºèª';
                
                header.appendChild(icon);
                header.appendChild(title);
                
                const content = document.createElement('div');
                content.className = 'custom-dialog-content';
                content.innerHTML = (options.message || '').replace(/\n/g, '<br>');
                
                const actions = document.createElement('div');
                actions.className = 'custom-dialog-actions';
                
                // å–æ¶ˆæŒ‰éˆ•
                if (options.showCancel !== false) {
                    const cancelBtn = document.createElement('button');
                    cancelBtn.className = 'custom-dialog-button secondary';
                    cancelBtn.textContent = options.cancelText || 'å–æ¶ˆ';
                    cancelBtn.onclick = () => {
                        hideDialog();
                        resolve(false);
                    };
                    actions.appendChild(cancelBtn);
                }
                
                // ç¢ºèªæŒ‰éˆ•
                const confirmBtn = document.createElement('button');
                confirmBtn.className = `custom-dialog-button ${options.type === 'danger' ? 'danger' : 'primary'}`;
                confirmBtn.textContent = options.confirmText || 'ç¢ºèª';
                confirmBtn.onclick = () => {
                    hideDialog();
                    resolve(true);
                };
                actions.appendChild(confirmBtn);
                
                dialog.appendChild(header);
                dialog.appendChild(content);
                dialog.appendChild(actions);
                overlay.appendChild(dialog);
                document.body.appendChild(overlay);
                
                function hideDialog() {
                    overlay.classList.remove('show');
                    setTimeout(() => {
                        if (document.body.contains(overlay)) {
                            document.body.removeChild(overlay);
                        }
                    }, 300);
                }
                
                // é¡¯ç¤ºå°è©±æ¡†
                setTimeout(() => {
                    overlay.classList.add('show');
                }, 10);
                
                // ESC éµé—œé–‰
                const handleKeydown = (e) => {
                    if (e.key === 'Escape') {
                        hideDialog();
                        resolve(false);
                        document.removeEventListener('keydown', handleKeydown);
                    }
                };
                document.addEventListener('keydown', handleKeydown);
                
                // é»æ“ŠèƒŒæ™¯é—œé–‰
                overlay.onclick = (e) => {
                    if (e.target === overlay) {
                        hideDialog();
                        resolve(false);
                    }
                };
            });
        };
        
        // ä¾¿æ·ç¢ºèªå‡½æ•¸
        window.customConfirm = function(message, title = 'ç¢ºèª') {
            return window.showCustomDialog({
                icon: 'help_outline',
                title: title,
                message: message,
                confirmText: 'ç¢ºèª',
                cancelText: 'å–æ¶ˆ'
            });
        };
        
        // MD3 çµ±ä¸€å°è©±æ¡†ç³»çµ± - åŸºæ–¼ç¾æœ‰çš„ showCustomDialog
        window.mdAlert = window.mdAlert || function(message, type = 'info', title = null) {
            const iconMap = {
                'error': 'error',
                'warning': 'warning',
                'success': 'check_circle',
                'info': 'info'
            };
            
            const titleMap = {
                'error': 'è¨Šæ¯',
                'warning': 'è­¦å‘Š', 
                'success': 'æˆåŠŸ',
                'info': 'è¨Šæ¯'
            };
            
            return window.showCustomDialog({
                icon: iconMap[type] || 'info',
                title: title || titleMap[type] || 'è¨Šæ¯',
                message: message,
                confirmText: 'ç¢ºå®š',
                showCancel: false
            });
        };

        window.mdConfirm = window.mdConfirm || function(message, callback, title = 'ç¢ºèª') {
            return window.showCustomDialog({
                icon: 'help_outline',
                title: title,
                message: message,
                confirmText: 'ç¢ºå®š',
                cancelText: 'å–æ¶ˆ'
            }).then(result => {
                if (callback) callback(result);
                return result;
            });
        };

        window.mdPrompt = window.mdPrompt || function(message, callback, defaultValue = '', title = 'è¼¸å…¥') {
            const input = prompt(message, defaultValue);
            if (callback) callback(input);
            return input;
        };
        
        // ç¢ºä¿å°è©±æ¡†å‡½æ•¸åœ¨æ¨¡çµ„è¼‰å…¥å‰å°±å¯ç”¨
        console.log('âœ… MD3 å°è©±æ¡†å‚™ç”¨å‡½æ•¸å·²åˆå§‹åŒ–');
    </script>
</head>
<body>
    <div class="container">
        <header class="app-bar">
            <h1>å€‹äººæŠ•è³‡ç´€éŒ„è¡¨</h1>
            <div class="app-bar-actions">
                <div class="database-status connecting" id="databaseStatus" title="è³‡æ–™åº«é€£ç·šç‹€æ…‹" style="display: none;">
                    <span class="material-icons">storage</span>
                    <span class="status-text">åˆå§‹åŒ–ä¸­...</span>
                </div>
            </div>
        </header>
        
        <nav class="navigation-tabs">
            <button class="navigation-tab active" data-tab="stocks">
                <span class="material-icons">trending_up</span>
                <span>è‚¡ç¥¨æŠ•è³‡</span>
            </button>
            <button class="navigation-tab" data-tab="funds">
                <span class="material-icons">account_balance</span>
                <span>åŸºé‡‘å®šæŠ•</span>
            </button>
            <button class="navigation-tab" data-tab="crypto">
                <span class="material-icons">currency_bitcoin</span>
                <span>åŠ å¯†è²¨å¹£</span>
            </button>
            <button class="navigation-tab" data-tab="property">
                <span class="material-icons">home</span>
                <span>æˆ¿å±‹è²¸æ¬¾</span>
            </button>
            <button class="navigation-tab" data-tab="portfolio">
                <span class="material-icons">pie_chart</span>
                <span>æŒå€‰åˆ†æ</span>
            </button>
            <button class="navigation-tab" data-tab="summary">
                <span class="material-icons">analytics</span>
                <span>ç¸½è¦½åˆ†æ</span>
            </button>
        </nav>

        <main>
            <!-- è‚¡ç¥¨æŠ•è³‡ -->
            <div id="stocks" class="tab-content active">
                <!-- è‚¡ç¥¨è²·é€²å€å¡Š -->
                <section class="card growth-theme">
                    <div class="card-status-indicator"></div>
                    <h3 class="card-header">
                        <span class="emoji">ğŸŒ±</span>
                        è‚¡ç¥¨è²·é€²
                    </h3>
                    <p class="card-subtitle">è‡ªå¾‹å³æ˜¯è‡ªç”±</p>
                    
                    <div class="form-section">
                        <h4 class="form-section-title">åŸºæœ¬è³‡è¨Š</h4>
                        <div class="form-row core-fields buy-form">
                            <div class="text-field">
                                <select id="buyStockMarket" onchange="updateBuyStockForm()">
                                    <option value="å°è‚¡">å°è‚¡ (TWD)</option>
                                    <option value="ç¾è‚¡">ç¾è‚¡ (USD)</option>
                                </select>
                                <label>å¸‚å ´</label>
                            </div>
                            <div class="text-field">
                                <select id="buyStockAssetType">
                                    <option value="è‚¡ç¥¨">è‚¡ç¥¨</option>
                                    <option value="ETF">ETF</option>
                                </select>
                                <label>è³‡ç”¢é¡å‹</label>
                            </div>
                            <div class="text-field">
                                <input type="text" id="buyStockCode" placeholder=" " required>
                                <label>è‚¡ç¥¨ä»£è™Ÿ</label>
                            </div>
                        </div>
                    </div>
                    
                    <div class="form-section">
                        <h4 class="form-section-title">äº¤æ˜“è©³æƒ…</h4>
                        <div class="form-row">
                            <div class="text-field">
                                <input type="date" id="buyStockDate" required>
                                <label>äº¤æ˜“æ—¥æœŸ</label>
                            </div>
                            <div class="text-field">
                                <input type="number" id="buyStockShares" placeholder=" " min="0" step="1" required>
                                <label>è²·å…¥è‚¡æ•¸</label>
                            </div>
                            <div class="text-field">
                                <input type="number" step="0.01" id="buyStockPrice" placeholder=" " min="0" required>
                                <label id="buyStockPriceLabel">è²·å…¥åƒ¹æ ¼ (TWD)</label>
                            </div>
                            <div class="text-field">
                                <input type="number" step="1" id="buyStockFee" placeholder=" " min="0" required>
                                <label id="buyStockFeeLabel">æ‰‹çºŒè²» (å°è‚¡æ•´æ•¸)</label>
                                <div class="helper-text">è«‹è¼¸å…¥æ‚¨åˆ¸å•†çš„å¯¦éš›æ‰‹çºŒè²»</div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="button-group end">
                        <button class="filled-button growth-action" onclick="addStockBuyRecord()">
                            <span class="material-icons">add_circle</span>
                            è¨˜éŒ„é€™ç­†æˆé•·æŠ•è³‡
                        </button>
                    </div>
                </section>

                <!-- è‚¡ç¥¨è³£å‡ºå€å¡Š -->
                <section class="card action-theme">
                    <div class="card-status-indicator"></div>
                    <h3 class="card-header">
                        <span class="emoji">âš¡</span>
                        è‚¡ç¥¨è³£å‡º
                    </h3>
                    <p class="card-subtitle">è½è¢‹ç‚ºå®‰æ‰æ˜¯çœŸç²åˆ©</p>
                    
                    <div class="form-section">
                        <h4 class="form-section-title">åŸºæœ¬è³‡è¨Š</h4>
                        <div class="form-row core-fields">
                            <div class="text-field">
                                <select id="sellStockMarket" onchange="updateSellStockForm()">
                                    <option value="å°è‚¡">å°è‚¡ (TWD)</option>
                                    <option value="ç¾è‚¡">ç¾è‚¡ (USD)</option>
                                </select>
                                <label>å¸‚å ´</label>
                            </div>
                            <div class="text-field">
                                <select id="sellStockAssetType">
                                    <option value="è‚¡ç¥¨">è‚¡ç¥¨</option>
                                    <option value="ETF">ETF</option>
                                </select>
                                <label>è³‡ç”¢é¡å‹</label>
                            </div>
                            <div class="text-field">
                                <input type="text" id="sellStockCode" placeholder=" " required>
                                <label>è‚¡ç¥¨ä»£è™Ÿ</label>
                            </div>
                            <div class="text-field">
                                <input type="date" id="sellStockDate" required>
                                <label>äº¤æ˜“æ—¥æœŸ</label>
                            </div>
                        </div>
                    </div>
                    
                    <div class="form-section">
                        <h4 class="form-section-title">äº¤æ˜“è©³æƒ…</h4>
                        <div class="form-row">
                            <div class="text-field">
                                <input type="number" id="sellStockShares" placeholder=" " min="0" step="1" required>
                                <label>è³£å‡ºè‚¡æ•¸</label>
                            </div>
                            <div class="text-field">
                                <input type="number" step="0.01" id="sellStockPrice" placeholder=" " min="0" required>
                                <label id="sellStockPriceLabel">è³£å‡ºåƒ¹æ ¼ (TWD)</label>
                            </div>
                            <div class="text-field">
                                <input type="number" step="1" id="sellStockFee" placeholder=" " min="0" required>
                                <label id="sellStockFeeLabel">æ‰‹çºŒè²» (å°è‚¡æ•´æ•¸)</label>
                                <div class="helper-text">è«‹è¼¸å…¥æ‚¨åˆ¸å•†çš„å¯¦éš›æ‰‹çºŒè²»</div>
                            </div>
                            <div class="text-field" id="sellStockTaxField" style="display: block;">
                                <input type="number" step="1" id="sellStockTax" placeholder=" " min="0" required>
                                <label>è­‰äº¤ç¨… (åƒ…å°è‚¡)</label>
                                <div class="helper-text">å°è‚¡è³£å‡ºéœ€è¦è­‰äº¤ç¨…</div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="button-group end">
                        <button class="filled-button action-theme" onclick="addStockSellRecord()">
                            <span class="material-icons">trending_down</span>
                            è¨˜éŒ„é€™ç­†ç²åˆ©å¯¦ç¾
                        </button>
                    </div>
                </section>
                
                <section class="card neutral-theme">
                    <h3 class="card-header">
                        <span class="emoji">ğŸ’¼</span>
                        ç›®å‰æŒå€‰
                    </h3>
                    <p class="card-subtitle">æ‚¨çš„æŠ•è³‡çµ„åˆæ¦‚è¦½</p>
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>å¸‚å ´</th>
                                <th>é¡å‹</th>
                                <th>è‚¡ç¥¨ä»£è™Ÿ</th>
                                <th>å…¬å¸åç¨±</th>
                                <th>æŒè‚¡æ•¸é‡</th>
                                <th>å¹³å‡æˆæœ¬</th>
                                <th>æŒå€‰åƒ¹å€¼</th>
                            </tr>
                        </thead>
                        <tbody id="stockHoldingsTableBody"></tbody>
                    </table>
                </section>
                
                <section class="card neutral-theme">
                    <h3 class="card-header">
                        <span class="emoji">ğŸ“Š</span>
                        è‚¡ç¥¨æŠ•è³‡ç´€éŒ„
                    </h3>
                    <p class="card-subtitle">æ‚¨çš„æŠ•è³‡æ­·ç¨‹è»Œè·¡</p>
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>æ—¥æœŸ</th>
                                <th>å¸‚å ´</th>
                                <th>é¡å‹</th>
                                <th>è‚¡ç¥¨ä»£è™Ÿ</th>
                                <th>å…¬å¸åç¨±</th>
                                <th>äº¤æ˜“</th>
                                <th>è‚¡æ•¸</th>
                                <th>åƒ¹æ ¼</th>
                                <th>æ‰‹çºŒè²»</th>
                                <th>è­‰äº¤ç¨…</th>
                                <th>ç¸½é‡‘é¡</th>
                                <th>æ“ä½œ</th>
                            </tr>
                        </thead>
                        <tbody id="stockTableBody"></tbody>
                    </table>
                </section>

                <!-- API æ§åˆ¶é¢æ¿ -->
                <section class="card neutral-theme" style="display: none;">
                    <h3 class="card-header">
                        <span class="emoji">ğŸ› ï¸</span>
                        è‚¡ç¥¨ API æ§åˆ¶é¢æ¿
                    </h3>
                    <p class="card-subtitle">åƒ…å½±éŸ¿åç¨±æŸ¥è©¢ï¼Œä¸å½±éŸ¿äº¤æ˜“è³‡æ–™</p>
                    <div class="form-row">
                        <div class="text-field">
                            <input type="text" id="apiTestSymbol" placeholder="ä¾‹å¦‚ï¼š2330 æˆ– AAPL" value="2330">
                            <label>æ¸¬è©¦ä»£è™Ÿ</label>
                        </div>
                        <div class="button-group">
                            <button type="button" class="outlined-button" id="btnApiTest">æ¸¬è©¦ API</button>
                            <button type="button" class="outlined-button" id="btnCacheStats">åˆ·æ–°çµ±è¨ˆ</button>
                            <button type="button" class="error-button" id="btnClearCache">æ¸…é™¤å¿«å–</button>
                        </div>
                    </div>
                    <div style="margin-top:12px; color: var(--md-sys-color-on-surface-variant); font-size: var(--md-sys-typescale-body-medium-font-size);">
                        <div>å¿«å–é …ç›®æ•¸ï¼š<span id="cacheCount">0</span></div>
                        <div>æœ€è¿‘æŸ¥è©¢çµæœï¼š<span id="apiLastResult">ç„¡</span></div>
                    </div>
                </section>
            </div>

            <!-- åŸºé‡‘å®šæŠ• -->
            <div id="funds" class="tab-content">
                <section class="card growth-theme">
                    <div class="card-status-indicator"></div>
                    <h3 class="card-header">
                        <span class="emoji">ğŸ¦</span>
                        åŸºé‡‘äº¤æ˜“
                    </h3>
                    <p class="card-subtitle">ç¬¬å…«å¤§å¥‡è¹Ÿï¼Œæ™‚é–“è¤‡åˆ©çš„åŠ›é‡</p>
                    
                    <div class="form-section">
                        <h4 class="form-section-title">äº¤æ˜“åŸºæœ¬è³‡è¨Š</h4>
                        <div class="form-row core-fields">
                            <div class="text-field">
                                <select id="fundType">
                                    <option value="è²·å…¥">è²·å…¥</option>
                                    <option value="è´–å›">è´–å›</option>
                                </select>
                                <label>äº¤æ˜“é¡å‹</label>
                            </div>
                            <div class="text-field">
                                <input type="text" id="fundName" placeholder=" " required>
                                <label>åŸºé‡‘åç¨±</label>
                            </div>
                            <div class="text-field">
                                <input type="date" id="fundDate" required>
                                <label>äº¤æ˜“æ—¥æœŸ</label>
                            </div>
                        </div>
                    </div>
                    
                    <div class="form-section">
                        <h4 class="form-section-title">äº¤æ˜“è©³æƒ…</h4>
                        <div class="form-row">
                            <div class="text-field">
                                <input type="number" id="fundAmount" placeholder=" " min="0" required>
                                <label>äº¤æ˜“é‡‘é¡</label>
                            </div>
                            <div class="text-field">
                                <input type="number" step="0.0001" id="fundNav" placeholder=" " min="0" required>
                                <label>æ·¨å€¼</label>
                            </div>
                            <div class="text-field">
                                <input type="number" step="0.0001" id="fundUnits" placeholder=" " min="0">
                                <label>å–®ä½æ•¸</label>
                                <div class="helper-text">ç³»çµ±æœƒè‡ªå‹•è¨ˆç®—ï¼šé‡‘é¡Ã·æ·¨å€¼</div>
                            </div>
                            <div class="text-field">
                                <input type="number" step="0.01" id="fundFee" placeholder=" " min="0" required>
                                <label>æ‰‹çºŒè²»</label>
                                <div class="helper-text">è«‹è¼¸å…¥å¯¦éš›æ‰‹çºŒè²»ï¼Œå®šæœŸå®šé¡é€šå¸¸ç‚º0</div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="button-group end">
                        <button class="filled-button growth-action" onclick="addFundRecord()">
                            <span class="material-icons">savings</span>
                            è¨˜éŒ„é€™ç­†åŸºé‡‘äº¤æ˜“
                        </button>
                    </div>
                </section>
                
                <section class="card neutral-theme">
                    <h3 class="card-header">
                        <span class="emoji">ğŸ’°</span>
                        åŸºé‡‘æŒå€‰
                    </h3>
                    <p class="card-subtitle">æ‚¨çš„åŸºé‡‘æŠ•è³‡çµ„åˆ</p>
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>åŸºé‡‘åç¨±</th>
                                <th>æŒæœ‰å–®ä½æ•¸</th>
                                <th>å¹³å‡æ·¨å€¼</th>
                                <th>æŒå€‰åƒ¹å€¼</th>
                            </tr>
                        </thead>
                        <tbody id="fundHoldingsTableBody"></tbody>
                    </table>
                </section>
                
                <section class="card neutral-theme">
                    <h3 class="card-header">
                        <span class="emoji">ğŸ“‹</span>
                        åŸºé‡‘äº¤æ˜“ç´€éŒ„
                    </h3>
                    <p class="card-subtitle">æ‚¨çš„åŸºé‡‘æŠ•è³‡æ­·ç¨‹</p>
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>æ—¥æœŸ</th>
                                <th>äº¤æ˜“é¡å‹</th>
                                <th>åŸºé‡‘åç¨±</th>
                                <th>äº¤æ˜“é‡‘é¡</th>
                                <th>æ·¨å€¼</th>
                                <th>å–®ä½æ•¸</th>
                                <th>æ‰‹çºŒè²»</th>
                                <th>æ“ä½œ</th>
                            </tr>
                        </thead>
                        <tbody id="fundTableBody"></tbody>
                    </table>
                </section>
            </div>

            <!-- åŠ å¯†è²¨å¹£ -->
            <div id="crypto" class="tab-content">
                <section class="card action-theme">
                    <div class="card-status-indicator"></div>
                    <h3 class="card-header">
                        <span class="emoji">â‚¿</span>
                        ç¾è²¨äº¤æ˜“
                    </h3>
                    <p class="card-subtitle">é€šå¾€ç¾…é¦¬çš„é–€ç¥¨</p>
                    
                    <div class="form-section">
                        <h4 class="form-section-title">äº¤æ˜“åŸºæœ¬è³‡è¨Š</h4>
                        <div class="form-row core-fields crypto-form">
                            <div class="text-field">
                                <select id="cryptoSymbol" required>
                                </select>
                                <label>å¹£ç¨®</label>
                            </div>
                            <div class="text-field">
                                <select id="cryptoType">
                                    <option value="è²·å…¥">è²·å…¥</option>
                                    <option value="è³£å‡º">è³£å‡º</option>
                                </select>
                                <label>äº¤æ˜“é¡å‹</label>
                            </div>
                            <div class="text-field">
                                <input type="date" id="cryptoDate" required>
                                <label>äº¤æ˜“æ—¥æœŸ</label>
                            </div>
                        </div>
                    </div>
                    
                    <div class="form-section">
                        <h4 class="form-section-title">äº¤æ˜“è©³æƒ…</h4>
                        <div class="form-row crypto-form">
                            <div class="text-field">
                                <input type="text" id="cryptoAmount" placeholder="ä¾‹å¦‚: 0.00000001" pattern="[0-9]*\.?[0-9]*" inputmode="decimal" required>
                                <label>æ•¸é‡</label>
                                <div class="helper-text">æ”¯æ´å°æ•¸é»ç²¾ç¢ºè¼¸å…¥</div>
                            </div>
                            <div class="text-field">
                                <input type="number" step="0.01" min="0.01" id="cryptoPrice" placeholder=" " required>
                                <label>åƒ¹æ ¼ (TWD)</label>
                            </div>
                            <div class="text-field">
                                <input type="number" step="1" min="0" id="cryptoFee" placeholder=" " required>
                                <label>æ‰‹çºŒè²» (TWD)</label>
                                <div class="helper-text">è«‹è¼¸å…¥å¯¦éš›æ‰‹çºŒè²»ï¼Œå„äº¤æ˜“æ‰€è²»ç‡ä¸åŒ</div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="button-group end">
                        <button class="filled-button action-theme" onclick="addCryptoRecord()">
                            <span class="material-icons">currency_bitcoin</span>
                            è¨˜éŒ„é€™ç­†åŠ å¯†äº¤æ˜“
                        </button>
                    </div>
                </section>
                
                <section class="card neutral-theme">
                    <h3 class="card-header">
                        <span class="emoji">ğŸ’</span>
                        ç¾è²¨æŒå€‰
                    </h3>
                    <p class="card-subtitle">æ‚¨çš„æ•¸ä½è³‡ç”¢çµ„åˆ</p>
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>å¹£ç¨®</th>
                                <th>æŒæœ‰æ•¸é‡</th>
                                <th>å¹³å‡æˆæœ¬ (TWD)</th>
                                <th>æŒå€‰åƒ¹å€¼ (TWD)</th>
                            </tr>
                        </thead>
                        <tbody id="cryptoHoldingsTableBody"></tbody>
                    </table>
                </section>
                
                <section class="card neutral-theme">
                    <h3 class="card-header">
                        <span class="emoji">ğŸ”—</span>
                        ç¾è²¨äº¤æ˜“ç´€éŒ„
                    </h3>
                    <p class="card-subtitle">æ‚¨çš„å€å¡ŠéˆæŠ•è³‡è»Œè·¡</p>
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>æ—¥æœŸ</th>
                                <th>å¹£ç¨®</th>
                                <th>é¡å‹</th>
                                <th>æ•¸é‡</th>
                                <th>åƒ¹æ ¼ (TWD)</th>
                                <th>æ‰‹çºŒè²» (TWD)</th>
                                <th>ç¸½é‡‘é¡ (TWD)</th>
                                <th>æ“ä½œ</th>
                            </tr>
                        </thead>
                        <tbody id="cryptoTableBody"></tbody>
                    </table>
                </section>
            </div>

            <!-- æˆ¿å±‹è²¸æ¬¾ -->
            <div id="property" class="tab-content">
                <section class="card growth-theme">
                    <div class="card-status-indicator"></div>
                    <h3 class="card-header">
                        <span class="emoji">ğŸ </span>
                        æˆ¿å±‹è²¸æ¬¾è³‡è¨Š
                    </h3>
                    <p class="card-subtitle">ç‚ºæœªä¾†çš„å®¶åœ’å¥ å®šç©©å›ºåŸºç¤</p>
                    
                    <div class="form-section">
                        <h4 class="form-section-title">ç‰©ä»¶åŸºæœ¬è³‡æ–™</h4>
                        <div class="form-row core-fields property-form">
                            <div class="text-field">
                                <input type="text" id="propertyName" placeholder=" " required>
                                <label>ç‰©ä»¶åç¨±</label>
                            </div>
                            <div class="text-field">
                                <input type="number" id="propertyTotal" placeholder=" " min="0" required>
                                <label>ç¸½åƒ¹</label>
                            </div>
                            <div class="text-field">
                                <input type="number" id="propertyDown" placeholder=" " min="0" required>
                                <label>é ­æœŸæ¬¾</label>
                            </div>
                        </div>
                    </div>
                    
                    <div class="form-section">
                        <h4 class="form-section-title">è²¸æ¬¾æ¢ä»¶</h4>
                        <div class="form-row property-form">
                            <div class="text-field">
                                <input type="number" id="propertyLoan" placeholder=" " min="0" required>
                                <label>è²¸æ¬¾é‡‘é¡</label>
                            </div>
                            <div class="text-field">
                                <input type="number" step="0.01" id="propertyRate" placeholder=" " min="0" required>
                                <label>åˆ©ç‡ (%)</label>
                            </div>
                            <div class="text-field">
                                <input type="number" id="propertyYears" placeholder=" " min="0" required>
                                <label>è²¸æ¬¾å¹´é™</label>
                            </div>
                        </div>
                    </div>
                    
                    <div class="button-group end">
                        <button class="filled-button growth-action" onclick="addPropertyRecord()">
                            <span class="material-icons">home</span>
                            è¨˜éŒ„æˆ¿ç”¢è³‡è¨Š
                        </button>
                    </div>
                </section>

                <section class="card action-theme">
                    <div class="card-status-indicator"></div>
                    <h3 class="card-header">
                        <span class="emoji">ğŸ’³</span>
                        æˆ¿è²¸ç¹³æ¬¾ç´€éŒ„
                    </h3>
                    <p class="card-subtitle">æ¯ä¸€æ¬¡ç¹³æ¬¾ï¼Œéƒ½æ˜¯æœå¤¢æƒ³å®¶åœ’é‚é€²</p>
                    
                    <div class="form-section">
                        <h4 class="form-section-title">ç¹³æ¬¾è³‡è¨Š</h4>
                        <div class="form-row">
                            <div class="text-field">
                                <input type="date" id="paymentDate" required>
                                <label>ç¹³æ¬¾æ—¥æœŸ</label>
                            </div>
                            <div class="text-field">
                                <input type="number" id="paymentAmount" placeholder=" " min="0" required>
                                <label>ç¹³æ¬¾é‡‘é¡</label>
                            </div>
                            <div class="text-field">
                                <input type="number" id="principalAmount" placeholder=" " min="0" required>
                                <label>æœ¬é‡‘</label>
                            </div>
                            <div class="text-field">
                                <input type="number" id="interestAmount" placeholder=" " min="0" required>
                                <label>åˆ©æ¯</label>
                            </div>
                        </div>
                    </div>
                    
                    <div class="button-group end">
                        <button class="filled-button action-theme" onclick="addPaymentRecord()">
                            <span class="material-icons">payment</span>
                            è¨˜éŒ„ç¹³æ¬¾ç´€éŒ„
                        </button>
                    </div>
                </section>
                
                <section class="card neutral-theme">
                    <h3 class="card-header">
                        <span class="emoji">ğŸ›ï¸</span>
                        æˆ¿è²¸åŸºæœ¬è³‡è¨Š
                    </h3>
                    <p class="card-subtitle">æ‚¨çš„æˆ¿ç”¢æŠ•è³‡æ¦‚è¦½</p>
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>ç‰©ä»¶åç¨±</th>
                                <th>ç¸½åƒ¹</th>
                                <th>é ­æœŸæ¬¾</th>
                                <th>è²¸æ¬¾é‡‘é¡</th>
                                <th>åˆ©ç‡</th>
                                <th>å¹´é™</th>
                                <th>æ“ä½œ</th>
                            </tr>
                        </thead>
                        <tbody id="propertyTableBody"></tbody>
                    </table>
                </section>

                <section class="card neutral-theme">
                    <h3 class="card-header">
                        <span class="emoji">ğŸ“…</span>
                        ç¹³æ¬¾ç´€éŒ„
                    </h3>
                    <p class="card-subtitle">æ‚¨çš„é‚„æ¬¾æ­·ç¨‹è¿½è¹¤</p>
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>ç¹³æ¬¾æ—¥æœŸ</th>
                                <th>ç¹³æ¬¾é‡‘é¡</th>
                                <th>æœ¬é‡‘</th>
                                <th>åˆ©æ¯</th>
                                <th>æ“ä½œ</th>
                            </tr>
                        </thead>
                        <tbody id="paymentTableBody"></tbody>
                    </table>
                </section>
            </div>

            <!-- æŒå€‰åˆ†æ -->
            <div id="portfolio" class="tab-content">
                <section class="portfolio-grid">
                    <div class="portfolio-card">
                        <div class="portfolio-card-header">
                            <h3 class="portfolio-card-title">
                                <div class="portfolio-card-icon stock">ğŸ“ˆ</div>
                                è‚¡ç¥¨æŒå€‰
                            </h3>
                        </div>
                        <div class="portfolio-metrics">
                            <div class="portfolio-metric">
                                <div class="portfolio-metric-label">ç¸½æŒå€‰åƒ¹å€¼</div>
                                <div class="portfolio-metric-value" id="stockPortfolioValue">$0</div>
                            </div>
                            <div class="portfolio-metric">
                                <div class="portfolio-metric-label">æœªå¯¦ç¾æç›Š</div>
                                <div class="portfolio-metric-value" id="stockUnrealizedPL">$0</div>
                            </div>
                        </div>
                        <div class="portfolio-progress">
                            <div class="portfolio-progress-label">
                                <span>æŠ•è³‡çµ„åˆä½”æ¯”</span>
                                <span id="stockPortfolioPercentage">0%</span>
                            </div>
                            <div class="portfolio-progress-bar">
                                <div class="portfolio-progress-fill" id="stockProgressFill" style="width: 0%"></div>
                            </div>
                        </div>
                        <div class="portfolio-actions">
                            <button class="portfolio-action-btn" onclick="showTab('stocks')">
                                <span class="material-icons">visibility</span>
                                æŸ¥çœ‹è©³æƒ…
                            </button>
                        </div>
                    </div>

                    <div class="portfolio-card">
                        <div class="portfolio-card-header">
                            <h3 class="portfolio-card-title">
                                <div class="portfolio-card-icon fund">ğŸ¦</div>
                                åŸºé‡‘æŒå€‰
                            </h3>
                        </div>
                        <div class="portfolio-metrics">
                            <div class="portfolio-metric">
                                <div class="portfolio-metric-label">ç¸½æŒå€‰åƒ¹å€¼</div>
                                <div class="portfolio-metric-value" id="fundPortfolioValue">$0</div>
                            </div>
                            <div class="portfolio-metric">
                                <div class="portfolio-metric-label">æœªå¯¦ç¾æç›Š</div>
                                <div class="portfolio-metric-value" id="fundUnrealizedPL">$0</div>
                            </div>
                        </div>
                        <div class="portfolio-progress">
                            <div class="portfolio-progress-label">
                                <span>æŠ•è³‡çµ„åˆä½”æ¯”</span>
                                <span id="fundPortfolioPercentage">0%</span>
                            </div>
                            <div class="portfolio-progress-bar">
                                <div class="portfolio-progress-fill" id="fundProgressFill" style="width: 0%"></div>
                            </div>
                        </div>
                        <div class="portfolio-actions">
                            <button class="portfolio-action-btn" onclick="showTab('funds')">
                                <span class="material-icons">visibility</span>
                                æŸ¥çœ‹è©³æƒ…
                            </button>
                        </div>
                    </div>

                    <div class="portfolio-card">
                        <div class="portfolio-card-header">
                            <h3 class="portfolio-card-title">
                                <div class="portfolio-card-icon crypto">â‚¿</div>
                                åŠ å¯†è²¨å¹£æŒå€‰
                            </h3>
                        </div>
                        <div class="portfolio-metrics">
                            <div class="portfolio-metric">
                                <div class="portfolio-metric-label">ç¸½æŒå€‰åƒ¹å€¼</div>
                                <div class="portfolio-metric-value" id="cryptoPortfolioValue">$0</div>
                            </div>
                            <div class="portfolio-metric">
                                <div class="portfolio-metric-label">æœªå¯¦ç¾æç›Š</div>
                                <div class="portfolio-metric-value" id="cryptoUnrealizedPL">$0</div>
                            </div>
                        </div>
                        <div class="portfolio-progress">
                            <div class="portfolio-progress-label">
                                <span>æŠ•è³‡çµ„åˆä½”æ¯”</span>
                                <span id="cryptoPortfolioPercentage">0%</span>
                            </div>
                            <div class="portfolio-progress-bar">
                                <div class="portfolio-progress-fill" id="cryptoProgressFill" style="width: 0%"></div>
                            </div>
                        </div>
                        <div class="portfolio-actions">
                            <button class="portfolio-action-btn" onclick="showTab('crypto')">
                                <span class="material-icons">visibility</span>
                                æŸ¥çœ‹è©³æƒ…
                            </button>
                        </div>
                    </div>
                </section>

                <section class="holdings-table-container">
                    <div class="holdings-table-header">
                        <h3 class="holdings-table-title">
                            <span class="material-icons">account_balance_wallet</span>
                            æ•´é«”æŒå€‰æ¦‚è¦½
                        </h3>
                    </div>
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>è³‡ç”¢é¡åˆ¥</th>
                                <th>æ¨™çš„åç¨±</th>
                                <th>æŒæœ‰æ•¸é‡</th>
                                <th>å¹³å‡æˆæœ¬</th>
                                <th>ç›®å‰åƒ¹å€¼</th>
                                <th>æœªå¯¦ç¾æç›Š</th>
                                <th>å ±é…¬ç‡</th>
                                <th>æ“ä½œ</th>
                            </tr>
                        </thead>
                        <tbody id="portfolioOverviewTableBody"></tbody>
                    </table>
                </section>
            </div>

            <!-- ç¸½è¦½åˆ†æ -->
            <div id="summary" class="tab-content">
                <section class="card neutral-theme">
                    <h3 class="card-header">
                        <span class="emoji">âš™ï¸</span>
                        è³‡æ–™ç®¡ç†
                    </h3>
                    <p class="card-subtitle">å®‰å…¨å‚™ä»½æ‚¨çš„æŠ•è³‡æ•¸æ“š</p>
                    
                    <div class="button-group center">
                        <button class="outlined-button" onclick="exportData()">
                            <span class="material-icons">download</span>
                            åŒ¯å‡ºå‚™ä»½
                        </button>
                        <input type="file" id="importFile" accept=".json" style="display: none;" onchange="importData(event)">
                        <button class="outlined-button" onclick="triggerImport()">
                            <span class="material-icons">upload</span>
                            åŒ¯å…¥å‚™ä»½
                        </button>
                        <button class="error-button" onclick="clearAllData()">
                            <span class="material-icons">delete_forever</span>
                            æ¸…ç©ºè³‡æ–™
                        </button>
                    </div>
                    
                    <div class="card-divider"></div>
                    
                    <div style="text-align: center; font-size: var(--md-sys-typescale-body-medium-font-size); color: var(--md-sys-color-on-surface-variant);">
                        <span class="material-icons" style="font-size: 16px; vertical-align: middle; margin-right: 4px;">info</span>
                        æœ€å¾Œä¿å­˜æ™‚é–“ï¼š<span id="lastSaveTime">å¾æœªä¿å­˜</span> | 
                        è‡ªå‹•ä¿å­˜ï¼š<span style="color: var(--md-sys-color-success); font-weight: 500;">å·²å•Ÿç”¨</span>
                    </div>
                </section>
                
                <section class="card growth-theme">
                    <h3 class="card-header">
                        <span class="emoji">ğŸ’°</span>
                        æŠ•è³‡ç¸½è¦½
                    </h3>
                    <p class="card-subtitle">æ‚¨çš„è³‡ç”¢ç´¯ç©æˆæœ</p>
                    <div class="summary-grid">
                        <div class="summary-card">
                            <h4>å°è‚¡ç¸½æŠ•å…¥</h4>
                            <div class="amount negative" id="twStockTotalInvest">TWD $0</div>
                        </div>
                        <div class="summary-card">
                            <h4>ç¾è‚¡ç¸½æŠ•å…¥</h4>
                            <div class="amount negative" id="usStockTotalInvest">USD $0</div>
                        </div>
                        <div class="summary-card">
                            <h4>åŸºé‡‘ç¸½æŠ•å…¥</h4>
                            <div class="amount negative" id="fundTotalInvest">$0</div>
                        </div>
                        <div class="summary-card">
                            <h4>åŠ å¯†è²¨å¹£ç¸½æŠ•å…¥</h4>
                            <div class="amount negative" id="cryptoTotalInvest">$0</div>
                        </div>
                        <div class="summary-card">
                            <h4>æˆ¿è²¸å·²ç¹³æœ¬é‡‘</h4>
                            <div class="amount negative" id="propertyPaidPrincipal">$0</div>
                        </div>
                    </div>
                </section>
                
                <section class="card action-theme">
                    <h3 class="card-header">
                        <span class="emoji">ğŸ“ˆ</span>
                        è³‡ç”¢é…ç½®åˆ†æ
                    </h3>
                    <p class="card-subtitle">å¤šå…ƒåŒ–æŠ•è³‡çµ„åˆåˆ†ä½ˆ</p>
                    <div class="summary-grid">
                        <div class="summary-card">
                            <h4>å°è‚¡ - è‚¡ç¥¨</h4>
                            <div class="amount" style="color: var(--md-sys-color-warning);" id="twStockCount">0 æª”</div>
                        </div>
                        <div class="summary-card">
                            <h4>å°è‚¡ - ETF</h4>
                            <div class="amount" style="color: var(--md-sys-color-tertiary);" id="twEtfCount">0 æª”</div>
                        </div>
                        <div class="summary-card">
                            <h4>ç¾è‚¡ - è‚¡ç¥¨</h4>
                            <div class="amount" style="color: var(--md-sys-color-warning);" id="usStockCount">0 æª”</div>
                        </div>
                        <div class="summary-card">
                            <h4>ç¾è‚¡ - ETF</h4>
                            <div class="amount" style="color: var(--md-sys-color-tertiary);" id="usEtfCount">0 æª”</div>
                        </div>
                    </div>
                </section>
            </div>
        </main>
    </div>
    
    <!-- M3 Expressive é€²éšåŠŸèƒ½ JavaScript -->
    <script>
        // é ç±¤åˆ‡æ›å‚™ç”¨å‡½æ•¸ï¼ˆå¦‚æœæ¨¡çµ„è¼‰å…¥å¤±æ•—æ™‚ä½¿ç”¨ï¼‰
        window.showTab = window.showTab || function(tabName) {
            if (!tabName) return;

            console.log(`Switching to tab: ${tabName}`);
            
            // éš±è—æ‰€æœ‰é ç±¤å…§å®¹
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
            });

            // ç§»é™¤æ‰€æœ‰é ç±¤çš„ 'active' class
            document.querySelectorAll('.navigation-tab').forEach(tab => {
                tab.classList.remove('active');
            });

            // é¡¯ç¤ºç›®æ¨™é ç±¤çš„å…§å®¹
            const activeContent = document.getElementById(tabName);
            if (activeContent) {
                activeContent.classList.add('active');
            }

            // å°‡ç›®æ¨™é ç±¤è¨­ç‚º 'active'
            const activeTab = document.querySelector(`.navigation-tab[data-tab="${tabName}"]`);
            if (activeTab) {
                activeTab.classList.add('active');
            }
        };

        // åˆå§‹åŒ–é ç±¤åˆ‡æ›äº‹ä»¶
        document.addEventListener('DOMContentLoaded', function() {
            const tabs = document.querySelectorAll('.navigation-tab');
            tabs.forEach(tab => {
                tab.addEventListener('click', function() {
                    const targetTab = this.getAttribute('data-tab');
                    window.showTab(targetTab);
                });
            });
            
            // é è¨­é¡¯ç¤ºç¬¬ä¸€å€‹é ç±¤
            window.showTab('stocks');

        });

        // é€²éšé¸é …åˆ‡æ›åŠŸèƒ½
        function toggleAdvancedOptions(type) {
            const toggleButton = document.querySelector(`.form-advanced-toggle[onclick*="${type}"]`);
            const optionsDiv = document.getElementById(`${type}AdvancedOptions`);
            const icon = toggleButton.querySelector('.material-icons');
            
            if (optionsDiv.style.display === 'none' || optionsDiv.style.display === '') {
                // å±•é–‹
                optionsDiv.style.display = 'block';
                toggleButton.classList.add('expanded');
                toggleButton.innerHTML = '<span class="material-icons">expand_less</span>æ”¶èµ·é€²éšé¸é …';
                
                // æ·»åŠ å±•é–‹å‹•ç•«
                optionsDiv.style.opacity = '0';
                optionsDiv.style.transform = 'translateY(-10px)';
                setTimeout(() => {
                    optionsDiv.style.transition = 'opacity 0.3s ease, transform 0.3s ease';
                    optionsDiv.style.opacity = '1';
                    optionsDiv.style.transform = 'translateY(0)';
                }, 10);
            } else {
                // æ”¶èµ·
                optionsDiv.style.transition = 'opacity 0.3s ease, transform 0.3s ease';
                optionsDiv.style.opacity = '0';
                optionsDiv.style.transform = 'translateY(-10px)';
                
                setTimeout(() => {
                    optionsDiv.style.display = 'none';
                    toggleButton.classList.remove('expanded');
                    toggleButton.innerHTML = '<span class="material-icons">expand_more</span>é€²éšé¸é …';
                }, 300);
            }
        }
        
        // æ·»åŠ æˆåŠŸå‹•ç•«æ•ˆæœ - å…¨å±€å¯ç”¨
        window.triggerSuccessAnimation = function(element) {
            if (element) {
                element.classList.add('success-animation');
                setTimeout(() => {
                    element.classList.remove('success-animation');
                }, 600);
            }
        };
        
        // æ·»åŠ æŒ‰éˆ•æˆåŠŸå›é¥‹ - å…¨å±€å¯ç”¨
        window.addButtonSuccessAnimation = function(buttonElement) {
            if (buttonElement) {
                buttonElement.classList.add('button-success-animation');
                const originalText = buttonElement.innerHTML;
                buttonElement.innerHTML = '<span class="material-icons">check_circle</span>å·²è¨˜éŒ„ï¼';
                
                setTimeout(() => {
                    buttonElement.classList.remove('button-success-animation');
                    buttonElement.innerHTML = originalText;
                }, 1500);
            }
        };
        
        // æ™ºæ…§è¡¨å–®é©—è­‰å›é¥‹
        function addFormValidationFeedback() {
            const textFields = document.querySelectorAll('.text-field');
            
            textFields.forEach(field => {
                const input = field.querySelector('input, select');
                
                if (input) {
                    input.addEventListener('blur', function() {
                        if (this.checkValidity() && this.value.trim() !== '') {
                            field.classList.remove('error');
                            field.classList.add('success');
                        } else if (!this.checkValidity()) {
                            field.classList.remove('success');
                            field.classList.add('error');
                        } else {
                            field.classList.remove('success', 'error');
                        }
                    });
                    
                    input.addEventListener('input', function() {
                        if (field.classList.contains('error') && this.checkValidity()) {
                            field.classList.remove('error');
                        }
                    });
                }
            });
        }
        
        
        // åˆå§‹åŒ–M3 ExpressiveåŠŸèƒ½
        document.addEventListener('DOMContentLoaded', function() {
            // ç‚ºæ‰€æœ‰å¡ç‰‡æ·»åŠ æ‡¸åœæ•ˆæœ
            const cards = document.querySelectorAll('.card');
            cards.forEach(card => {
                card.addEventListener('mouseenter', function() {
                    this.style.transform = 'translateY(-2px)';
                });
                
                card.addEventListener('mouseleave', function() {
                    this.style.transform = 'translateY(0)';
                });
            });
            
            // åˆå§‹åŒ–è¡¨å–®é©—è­‰å›é¥‹
            addFormValidationFeedback();
            
            // æ·»åŠ æµ®ç¾å‹•ç•«æ•ˆæœ
            const observer = new IntersectionObserver((entries) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        entry.target.style.opacity = '1';
                        entry.target.style.transform = 'translateY(0)';
                    }
                });
            });
            
            // è§€å¯Ÿæ‰€æœ‰å¡ç‰‡
            cards.forEach(card => {
                card.style.opacity = '0';
                card.style.transform = 'translateY(20px)';
                card.style.transition = 'opacity 0.6s ease, transform 0.6s ease';
                observer.observe(card);
            });
        });
    </script>

    <!-- é¢æ¿ä¿åº•ç¶å®šï¼ˆè‹¥ä¸»ç¨‹å¼æœªè¼‰å…¥ä¹Ÿå¯é‹ä½œï¼‰ -->
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const lastResult = document.getElementById('apiLastResult');
            const cacheCount = document.getElementById('cacheCount');
            const input = document.getElementById('apiTestSymbol');
            const btnTest = document.getElementById('btnApiTest');
            const btnStats = document.getElementById('btnCacheStats');
            const btnClear = document.getElementById('btnClearCache');

            const bind = (el, handler) => { if (el) el.addEventListener('click', handler); };

            const refreshStats = async () => {
                try {
                    const mod = await import('./js/api/stockApiService.js');
                    const stats = mod.getCacheStats();
                    if (cacheCount) cacheCount.textContent = String(stats.total);
                } catch (e) { console.warn('API é¢æ¿çµ±è¨ˆå¤±æ•—', e); }
            };

            bind(btnTest, async () => {
                try {
                    const code = (input?.value || '').trim();
                    if (!code) return;
                    const market = /[a-zA-Z]/.test(code) ? 'ç¾è‚¡' : 'å°è‚¡';
                    const mod = await import('./js/api/stockApiService.js');
                    const name = await mod.queryStockName(market, code);
                    if (lastResult) lastResult.textContent = name ? `${code} ${name}` : '(ç„¡çµæœ)';
                    await refreshStats();
                } catch (e) { console.warn('API é¢æ¿æ¸¬è©¦å¤±æ•—', e); }
            });

            bind(btnStats, refreshStats);

            bind(btnClear, async () => {
                try {
                    const mod = await import('./js/api/stockApiService.js');
                    mod.clearStockNameCache();
                    await refreshStats();
                    if (lastResult) lastResult.textContent = 'ç„¡';
                } catch (e) { console.warn('API é¢æ¿æ¸…é™¤å¤±æ•—', e); }
            });

            // é¦–æ¬¡åˆ·æ–°
            refreshStats();
        });
    </script>
</body>
</html> 