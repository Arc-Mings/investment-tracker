/*
 * M3 Expressive Form 元件樣式
 * --------------------------------------------------
 * 基於Material Design 3 Expressive的情感支持表單設計
 * 專為投資紀錄應用設計，減少使用焦慮，增加情感連結
 */

/* 表單行的 Grid 佈局 */
.form-row {
    display: grid;
    grid-template-columns: repeat(4, 1fr); /* 固定4欄佈局 */
    gap: var(--md-sys-spacing-medium); /* 適中的間距 */
    margin-bottom: var(--md-sys-spacing-large);
}

/* 
 * 核心欄位組 - 視覺優先級最高
 * --------------------------------------------------
 */
.form-row.core-fields {
    grid-template-columns: repeat(4, 1fr); /* 調整為4欄佈局以配合股票賣出表單 */
    gap: var(--md-sys-spacing-medium); /* 適中間距保持整體平衡 */
    margin-bottom: var(--md-sys-spacing-extra-large);
}

/* 買進表單特殊配置 - 保持3欄佈局 */
.form-row.core-fields.buy-form {
    grid-template-columns: repeat(3, 1fr); /* 買進表單維持3欄 */
    gap: var(--md-sys-spacing-large); /* 增加間距以保持視覺平衡 */
}

/* 加密貨幣表單特殊配置 - 3欄居中佈局 */
.form-row.core-fields.crypto-form {
    grid-template-columns: repeat(3, 1fr); /* 加密貨幣表單3欄 */
    gap: var(--md-sys-spacing-large); /* 增加間距以保持視覺平衡 */
    justify-content: center; /* 整體居中 */
    max-width: 75%; /* 限制最大寬度讓內容更集中 */
    margin-left: auto; /* 左右自動邊距實現居中 */
    margin-right: auto;
    overflow: visible; /* 修復：允許下拉選單完全展示 */
}

/* 加密貨幣表單一般行 - 3欄居中佈局 */
.form-row.crypto-form {
    grid-template-columns: repeat(3, 1fr); /* 3欄佈局 */
    gap: var(--md-sys-spacing-large); /* 增加間距以保持視覺平衡 */
    justify-content: center; /* 整體居中 */
    max-width: 75%; /* 限制最大寬度讓內容更集中 */
    margin-left: auto; /* 左右自動邊距實現居中 */
    margin-right: auto;
    margin-bottom: var(--md-sys-spacing-large);
    overflow: visible; /* 修復：允許下拉選單完全展示 */
}

/* 預售屋表單特殊配置 - 3欄居中佈局 */
.form-row.core-fields.property-form {
    grid-template-columns: repeat(3, 1fr); /* 預售屋表單3欄 */
    gap: var(--md-sys-spacing-large); /* 增加間距以保持視覺平衡 */
    justify-content: center; /* 整體居中 */
    max-width: 75%; /* 限制最大寬度讓內容更集中 */
    margin-left: auto; /* 左右自動邊距實現居中 */
    margin-right: auto;
}

/* 預售屋表單一般行 - 3欄居中佈局 */
.form-row.property-form {
    grid-template-columns: repeat(3, 1fr); /* 3欄佈局 */
    gap: var(--md-sys-spacing-large); /* 增加間距以保持視覺平衡 */
    justify-content: center; /* 整體居中 */
    max-width: 75%; /* 限制最大寬度讓內容更集中 */
    margin-left: auto; /* 左右自動邊距實現居中 */
    margin-right: auto;
    margin-bottom: var(--md-sys-spacing-large);
}

/* 
 * 文字輸入區塊容器
 * --------------------------------------------------
 */
.text-field {
    position: relative;
    /* 動態高度適應內容 */
    min-height: 72px; /* 增加高度提供視覺呼吸空間 */
}

/* 
 * 通用輸入框與下拉選單樣式 - MD3 一致性設計
 * --------------------------------------------------
 */
.text-field input,
.text-field select {
    width: 100%;
    padding: 28px var(--md-sys-spacing-medium) 12px var(--md-sys-spacing-medium);
    border: 2px solid var(--md-sys-color-outline-variant);
    border-radius: var(--md-sys-shape-corner-expressive-medium); /* 使用表達性圓角 */
    background-color: var(--md-sys-color-surface-container-high);
    color: var(--md-sys-color-on-surface);
    font-family: 'Roboto', sans-serif;
    font-size: var(--md-sys-typescale-body-large-font-size);
    font-weight: var(--md-sys-typescale-body-large-font-weight);
    line-height: var(--md-sys-typescale-body-large-line-height);
    min-height: 68px;
    
    /* M3 Expressive 彈性動畫 */
    transition: 
        border-color var(--md-sys-motion-duration-medium2) var(--md-sys-motion-easing-spring-gentle),
        background-color var(--md-sys-motion-duration-medium1) var(--md-sys-motion-easing-emphasized),
        box-shadow var(--md-sys-motion-duration-medium2) var(--md-sys-motion-easing-spring-gentle),
        transform var(--md-sys-motion-duration-short4) var(--md-sys-motion-easing-spring-snappy);
}

/* 
 * 下拉選單特殊樣式 - MD3 規範
 * --------------------------------------------------
 */
.text-field select {
    cursor: pointer;
    appearance: none; /* 移除預設樣式 */
    padding-right: 56px; /* 為箭頭留足夠空間 */
    
    /* MD3 標準下拉箭頭 - 使用 Material Icons 風格 */
    background-image: url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='%23625B71'%3e%3cpath d='M7 10l5 5 5-5z'/%3e%3c/svg%3e");
    background-repeat: no-repeat;
    background-position: right 16px center;
    background-size: 24px 24px;
}


/* 
 * 輸入框焦點狀態 - 智慧反饋
 * --------------------------------------------------
 */
.text-field input:focus {
    outline: none;
    border-color: var(--md-sys-color-primary);
    background-color: var(--md-sys-color-surface-container-highest);
    box-shadow: 
        0 0 0 1px var(--md-sys-color-primary),
        var(--md-sys-elevation-level2);
    transform: translateY(-1px); /* 微妙的上浮效果 */
}

/* 
 * 輸入框懸停狀態 - 鼓勵互動
 * --------------------------------------------------
 */
.text-field input:hover:not(:focus) {
    border-color: var(--md-sys-color-on-surface);
    background-color: var(--md-sys-color-surface-container-highest);
    transform: translateY(-0.5px);
}

/* 
 * 浮動標籤樣式 - 增強視覺層次
 * --------------------------------------------------
 */
.text-field label {
    position: absolute;
    left: var(--md-sys-spacing-medium);
    top: 8px; /* 固定在頂部位置 */
    font-size: var(--md-sys-typescale-label-medium-font-size);
    font-weight: var(--md-sys-typescale-label-medium-font-weight);
    line-height: var(--md-sys-typescale-label-medium-line-height);
    color: var(--md-sys-color-primary);
    background-color: var(--md-sys-color-surface-container-high);
    padding: 0 var(--md-sys-spacing-extra-small);
    pointer-events: none;
    z-index: 1;
    
    /* 平滑的標籤動畫 */
    transition: 
        color var(--md-sys-motion-duration-medium1) var(--md-sys-motion-easing-emphasized),
        background-color var(--md-sys-motion-duration-medium1) var(--md-sys-motion-easing-emphasized);
}

/* 
 * 標籤焦點狀態
 * --------------------------------------------------
 */
.text-field input:focus + label,
.text-field select:focus + label {
    color: var(--md-sys-color-primary);
    background-color: var(--md-sys-color-surface-container-highest);
}

/* 
 * 錯誤狀態 - 溫和的警示設計
 * --------------------------------------------------
 */
.text-field input:invalid:not(:placeholder-shown),
.text-field.error input {
    border-color: var(--md-sys-color-error);
    background-color: var(--md-sys-color-error-container);
}

.text-field input:invalid:not(:placeholder-shown) + label,
.text-field.error label {
    color: var(--md-sys-color-error);
}

/* 
 * 成功狀態 - 積極的反饋
 * --------------------------------------------------
 */
.text-field.success input {
    border-color: var(--md-sys-color-success);
    background-color: var(--md-sys-color-success-container);
}

.text-field.success label {
    color: var(--md-sys-color-success);
}

/* 
 * 數字輸入特殊樣式
 * --------------------------------------------------
 */
.text-field input[type="number"] {
    text-align: right; /* 數字右對齊 */
    font-weight: 500; /* 數字稍微加粗提高可讀性 */
}

/* 
 * 日期輸入特殊樣式
 * --------------------------------------------------
 */
.text-field input[type="date"] {
    font-family: 'Roboto', sans-serif;
    padding-right: var(--md-sys-spacing-extra-large); /* 為日期選擇器留空間 */
}

/* 
 * MD3 下拉選單特殊樣式
 * --------------------------------------------------
 * 遵循 Material Design 3 的完整規範
 */
.text-field select {
    cursor: pointer;
    /* MD3 標準下拉箭頭 - 使用 Material Icons 風格 */
    background-image: url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='%23625B71'%3e%3cpath d='M7 10l5 5 5-5z'/%3e%3c/svg%3e");
    background-repeat: no-repeat;
    background-position: right 16px center;
    background-size: 24px 24px;
    appearance: none;
    padding-right: 56px; /* 為箭頭留足夠空間 */
    
    /* MD3 特殊效果 */
    border-radius: var(--md-sys-shape-corner-large); /* MD3 推薦的大圓角 */
    box-shadow: var(--md-sys-elevation-level1); /* 輕微陰影增強層次感 */
}

/* MD3 下拉選單焦點狀態 - 強制生效 */
select:focus,
.text-field select:focus {
    outline: none !important;
    border-color: #6750A4 !important; /* 主色調 */
    background-color: #FEF7FF !important; /* 最高層級容器色 */
    /* 焦點時箭頭變為主色調 */
    background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='%236750A4'%3e%3cpath d='M7 10l5 5 5-5z'/%3e%3c/svg%3e") !important;
    box-shadow: 
        0 0 0 2px #6750A4,
        0px 1px 3px 0px rgba(0, 0, 0, 0.3), 0px 4px 8px 3px rgba(0, 0, 0, 0.15) !important; /* level3 陰影 */
    transform: translateY(-1px) !important; /* 上浮效果 */
}

/* 下拉選單懸停狀態 - 強制生效 */
select:hover:not(:focus),
.text-field select:hover:not(:focus) {
    border-color: #1D1B20 !important; /* on-surface 顏色 */
    background-color: #FEF7FF !important;
    box-shadow: 0px 1px 2px 0px rgba(0, 0, 0, 0.3), 0px 2px 6px 2px rgba(0, 0, 0, 0.15) !important; /* level2 陰影 */
    transform: translateY(-0.5px) !important; /* 微浮效果 */
    /* 懸停時箭頭稍微加深 */
    background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='%23484248'%3e%3cpath d='M7 10l5 5 5-5z'/%3e%3c/svg%3e") !important;
}

/* 
 * MD3 自定義下拉選單組件
 * --------------------------------------------------
 */

/* 自定義下拉選單容器 */
.custom-select {
    position: relative;
    width: 100%;
    margin: 0;
    overflow: visible; /* 修復：確保下拉選項不被父容器截斷 */
}

/* 選單觸發按鈕 - 模擬原有的 text-field select 樣式 */
.custom-select .select-trigger {
    width: 100%;
    padding: 28px var(--md-sys-spacing-medium) 12px var(--md-sys-spacing-medium);
    border: 2px solid var(--md-sys-color-outline-variant);
    border-radius: var(--md-sys-shape-corner-large); /* MD3 推薦的大圓角 */
    background-color: var(--md-sys-color-surface-container-high);
    color: var(--md-sys-color-on-surface);
    font-family: 'Roboto', sans-serif;
    font-size: var(--md-sys-typescale-body-large-font-size);
    font-weight: var(--md-sys-typescale-body-large-font-weight);
    line-height: var(--md-sys-typescale-body-large-line-height);
    min-height: 68px;
    cursor: pointer;
    display: flex;
    justify-content: space-between;
    align-items: center;
    user-select: none;
    margin: 0; /* 移除會累積的間距 */
    
    /* M3 Expressive 彈性動畫 */
    transition: 
        border-color var(--md-sys-motion-duration-medium2) var(--md-sys-motion-easing-spring-gentle),
        background-color var(--md-sys-motion-duration-medium2) var(--md-sys-motion-easing-spring-gentle),
        transform var(--md-sys-motion-duration-short2) var(--md-sys-motion-easing-standard);
}

/* 下拉箭頭 - 使用 MD3 風格 */
.custom-select .select-trigger::after {
    content: "";
    width: 24px;
    height: 24px;
    background-image: url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='%23625B71'%3e%3cpath d='M7 10l5 5 5-5z'/%3e%3c/svg%3e");
    background-repeat: no-repeat;
    background-position: center;
    background-size: 24px 24px;
    transition: transform var(--md-sys-motion-duration-short2) var(--md-sys-motion-easing-standard);
}

/* 展開狀態的箭頭旋轉 */
.custom-select.open .select-trigger::after {
    transform: rotate(180deg);
}

/* 觸發按鈕懸停狀態 */
.custom-select .select-trigger:hover:not(:focus) {
    border-color: var(--md-sys-color-on-surface);
    background-color: var(--md-sys-color-surface-container-highest);
    transform: translateY(-0.5px);
    box-shadow: 0px 1px 2px 0px rgba(0, 0, 0, 0.3), 0px 2px 6px 2px rgba(0, 0, 0, 0.15);
}

/* 觸發按鈕焦點狀態 */
.custom-select .select-trigger:focus,
.custom-select.open .select-trigger {
    outline: none;
    border-color: var(--md-sys-color-primary);
    background-color: var(--md-sys-color-surface-container-highest);
    box-shadow: 
        0 0 0 2px var(--md-sys-color-primary),
        0px 1px 3px 0px rgba(0, 0, 0, 0.3), 0px 4px 8px 3px rgba(0, 0, 0, 0.15);
    transform: translateY(-1px);
}

/* 下拉選項容器 - 關鍵的圓角實現 */
.custom-select .select-options {
    position: absolute; /* 不影響文檔流 */
    top: 100%; /* 精確定位 */
    left: 0;
    right: 0;
    margin-top: 4px; /* 只保留小間距 */
    background-color: var(--md-sys-color-surface-container-high);
    border-radius: var(--md-sys-shape-corner-large); /* 整個容器的圓角 */
    box-shadow: 0px 4px 12px 0px rgba(0, 0, 0, 0.15), 0px 8px 24px 6px rgba(0, 0, 0, 0.1);
    overflow: visible; /* 修復：允許內容完全顯示 */
    z-index: 9999; /* 修復：提高層級確保不被遮擋 */
    max-height: 300px; /* 修復：設置最大高度 */
    overflow-y: auto; /* 修復：超出時可滾動 */
    opacity: 0;
    visibility: hidden;
    transform: translateY(-10px);
    transition: 
        opacity var(--md-sys-motion-duration-medium2) var(--md-sys-motion-easing-emphasized),
        visibility var(--md-sys-motion-duration-medium2) var(--md-sys-motion-easing-emphasized),
        transform var(--md-sys-motion-duration-medium2) var(--md-sys-motion-easing-emphasized);
}

/* 展開狀態的選項容器 */
.custom-select.open .select-options {
    opacity: 1;
    visibility: visible;
    transform: translateY(0);
}

/* 個別選項樣式 - 統一標準，確保所有頁籤一致 */
.text-field.custom-select .option,
.custom-select .option {
    padding: 16px var(--md-sys-spacing-medium) !important;
    cursor: pointer;
    color: var(--md-sys-color-on-surface);
    font-family: 'Roboto', sans-serif;
    font-size: var(--md-sys-typescale-body-large-font-size);
    font-weight: var(--md-sys-typescale-body-large-font-weight);
    line-height: var(--md-sys-typescale-body-large-line-height);
    transition: background-color var(--md-sys-motion-duration-short2) var(--md-sys-motion-easing-standard);
    margin: 0 !important; /* 統一標準：選項間無額外邊距 */
    border: none !important; /* 確保無邊框 */
    box-sizing: border-box !important; /* 統一盒模型 */
}

/* 選項懸停狀態 - 提高特異性 */
.text-field.custom-select .option:hover,
.custom-select .option:hover {
    background-color: var(--md-sys-color-primary-container) !important;
    color: var(--md-sys-color-on-primary-container) !important;
    margin: 0 !important;
}

/* 選中的選項 - 提高特異性 */
.text-field.custom-select .option.selected,
.custom-select .option.selected {
    background-color: var(--md-sys-color-primary) !important;
    color: var(--md-sys-color-on-primary) !important;
    font-weight: var(--md-sys-typescale-body-large-font-weight) !important;
    margin: 0 !important;
}

/* 第一個選項的上方圓角 */
.custom-select .option:first-child {
    border-top-left-radius: var(--md-sys-shape-corner-large);
    border-top-right-radius: var(--md-sys-shape-corner-large);
}

/* 最後一個選項的下方圓角 */
.custom-select .option:last-child {
    border-bottom-left-radius: var(--md-sys-shape-corner-large);
    border-bottom-right-radius: var(--md-sys-shape-corner-large);
}

/* 隱藏原生 select（如果需要保持向後相容性） */
.custom-select select {
    display: none;
}

/* 
 * 修復加密貨幣和預售屋表單中自定義下拉選單的間距問題
 * 覆蓋 .crypto-form 和 .property-form 的 gap 影響
 * --------------------------------------------------
 */
.form-row.crypto-form .custom-select .option,
.form-row.property-form .custom-select .option {
    margin: 0 !important;
    padding: 16px var(--md-sys-spacing-medium) !important;
}

.form-row.crypto-form .custom-select .select-options,
.form-row.property-form .custom-select .select-options {
    gap: 0 !important;
    margin-top: 4px !important;
}

/* 確保所有自定義下拉選單的選項容器都有一致的間距 */
.custom-select .select-options {
    margin-top: 4px; /* 統一的小間距 */
}

.custom-select .select-trigger {
    margin: 0; /* 確保觸發按鈕沒有多餘間距 */
}

/* 
 * 必填欄位標示
 * --------------------------------------------------
 */
.text-field input[required] + label::after {
    content: ' *';
    color: var(--md-sys-color-error);
    font-weight: 700;
}

/* 
 * 表單區塊分組
 * --------------------------------------------------
 */
.form-section {
    margin-bottom: var(--md-sys-spacing-huge);
}

.form-section-title {
    font-size: var(--md-sys-typescale-title-medium-font-size);
    font-weight: var(--md-sys-typescale-title-medium-font-weight);
    line-height: var(--md-sys-typescale-title-medium-line-height);
    color: var(--md-sys-color-on-surface);
    margin-bottom: var(--md-sys-spacing-medium);
    padding-bottom: var(--md-sys-spacing-small);
    border-bottom: 1px solid var(--md-sys-color-outline-variant);
}

/* 
 * 進階選項摺疊區域
 * --------------------------------------------------
 */
.form-advanced-options {
    margin-top: var(--md-sys-spacing-medium);
    opacity: 0.8;
    transition: opacity var(--md-sys-motion-duration-medium2) var(--md-sys-motion-easing-emphasized);
}

.form-advanced-options:hover {
    opacity: 1;
}

.form-advanced-toggle {
    background: none;
    border: none;
    color: var(--md-sys-color-primary);
    font-size: var(--md-sys-typescale-label-large-font-size);
    font-weight: var(--md-sys-typescale-label-large-font-weight);
    cursor: pointer;
    padding: var(--md-sys-spacing-small) 0;
    margin-bottom: var(--md-sys-spacing-medium);
    display: flex;
    align-items: center;
    gap: var(--md-sys-spacing-small);
    
    transition: color var(--md-sys-motion-duration-medium1) var(--md-sys-motion-easing-emphasized);
}

.form-advanced-toggle:hover {
    color: var(--md-sys-color-primary-container);
}

.form-advanced-toggle .material-icons {
    transition: transform var(--md-sys-motion-duration-medium2) var(--md-sys-motion-easing-spring-gentle);
}

.form-advanced-toggle.expanded .material-icons {
    transform: rotate(180deg);
}

/* 
 * 動畫效果
 * --------------------------------------------------
 */
@keyframes fieldFadeIn {
    from {
        opacity: 0;
        transform: translateY(var(--md-sys-spacing-medium));
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

.text-field {
    animation: fieldFadeIn var(--md-sys-motion-duration-medium3) var(--md-sys-motion-easing-emphasized);
}

/* 
 * 輔助文字樣式
 * --------------------------------------------------
 */
.text-field .helper-text {
    font-size: var(--md-sys-typescale-body-small-font-size);
    line-height: var(--md-sys-typescale-body-small-line-height);
    color: var(--md-sys-color-on-surface-variant);
    margin-top: var(--md-sys-spacing-extra-small);
    padding-left: var(--md-sys-spacing-medium);
    
    transition: color var(--md-sys-motion-duration-medium1) var(--md-sys-motion-easing-emphasized);
}

.text-field.error .helper-text {
    color: var(--md-sys-color-error);
}

.text-field.success .helper-text {
    color: var(--md-sys-color-success);
} 